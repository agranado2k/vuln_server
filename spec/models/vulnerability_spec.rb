# frozen_string_literal: true

require 'rails_helper'

RSpec.describe Vulnerability, type: :model do
  let(:group_id) { 'com.example.my_group' }
  let(:artifact_id) { 'my_package' }
  let(:version) { '1.0.0' }
  context 'when DOES NOT find vulnerability' do
    let(:params) do
      {
        group_id: group_id,
        artifact_id: 'invalid_artifact',
        version: version
      }
    end

    it { expect(subject.check(params)).to be_empty }
  end

  context 'when find vulnerabilities' do
    let(:params) do
      {
        group_id: group_id,
        artifact_id: artifact_id,
        version: version
      }
    end
    let(:vulns) do
      [
        {
          rank: 'M',
          name: 'Improper Authentication',
          package: "#{group_id}:#{artifact_id}:#{version}"
        }
      ]
    end

    it { expect(subject.check(params)).to_not be_empty }

    it { expect(subject.check(params)).to eq(vulns) }
  end
end
